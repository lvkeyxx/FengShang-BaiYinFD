<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="IFSAPP_SDIC_INDEX_DATA" >
  <resultMap id="abatorgenerated_SdicIndexDataResult" class="com.domain.SdicIndexData" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Dec 10 12:07:21 CST 2016.
    -->
    <result column="MEASURE_PERIOD" property="measurePeriod" jdbcType="VARCHAR" />
    <result column="MEASURE_TYPE" property="measureType" jdbcType="VARCHAR" />
    <result column="COMPANY_ID" property="companyId" jdbcType="DECIMAL" />
    <result column="INDEX_ID" property="indexId" jdbcType="DECIMAL" />
    <result column="POWER_UNIT_ID" property="powerUnitId" jdbcType="DECIMAL" />
    <result column="NUM_VALUE" property="numValue" jdbcType="FLOAT" />
    <result column="LAST_UPDATE_DATE" property="lastUpdateDate" jdbcType="TIMESTAMP" />
  </resultMap>
 
  <select id="selectForListSdicIndexData" resultMap="abatorgenerated_SdicIndexDataResult" parameterClass="com.domain.SdicIndexData" >
    select MEASURE_PERIOD, MEASURE_TYPE, COMPANY_ID, INDEX_ID, POWER_UNIT_ID, NUM_VALUE,
      LAST_UPDATE_DATE
    from SDICAPP.SDIC_INDEX_DATA
	<dynamic prepend="where" >
      <isPropertyAvailable prepend="and" property="indexId" >
        INDEX_ID = #indexId:DECIMALR#
        and MEASURE_PERIOD like (select distinct Max(substr(MEASURE_PERIOD,1,8)) as MEASURE_PERIOD 
        from SDICAPP.SDIC_INDEX_DATA where INDEX_ID = #indexId:DECIMALR#)||'%'
      </isPropertyAvailable>
      <isPropertyAvailable prepend="and" property="powerUnitId" >
        POWER_UNIT_ID = #powerUnitId:DECIMALR#
      </isPropertyAvailable>  
    </dynamic>
    order by MEASURE_PERIOD,POWER_UNIT_ID
  </select>
 
</sqlMap>